{"version":3,"sources":["webpack:///webpack/bootstrap 7f581201574d13b4a898","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"mongorito\"","webpack:///external \"joi\"","webpack:///./src/utils.js","webpack:///./src/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"dotenv\"","webpack:///external \"amqplib\"","webpack:///external \"mongorito-timestamps\"","webpack:///external \"raven\"","webpack:///external \"talisman/metrics/distance/dice\"","webpack:///external \"talisman/metrics/distance/eudex\"","webpack:///external \"talisman/metrics/distance/jaro-winkler\"","webpack:///external \"talisman/metrics/distance/mra\"","webpack:///external \"talisman/metrics/distance/levenshtein\"","webpack:///./src/errors.js","webpack:///./src/match.js","webpack:///./src/league.js","webpack:///./src/team.js"],"names":["InvalidSchemaError","Utils","message","content","properties","JSON","parse","toString","error","data","schema","Joi","validate","from","to","console","log","diceValue","similarity","jaroWinklerValue","jaroWinkler","levenshteinValue","levenshtein","dice","type","entity","db","process","env","MONGODB_URI","connect","use","timestamps","register","MatchService","model","TeamService","LeagueService","initDbConnection","amqplib","RABBITMQ_URI","connection","createChannel","channel","assertQueue","QueueTypes","CREATE_MATCH","FAILED_MATCH","prefetch","initRabbitMQConnection","consume","getContentAsJSON","matchData","VALIDATE_BASE","validateSchema","homeTeam","awayTeam","league","game","date","matchId","gameId","leagueService","algoCheck","init","similarityCheck","leagueUnique","unique","leagueId","id","homeTeamService","homeTeamUnique","homeTeamId","awayTeamService","awayTeamUnique","awayTeamId","Raven","captureException","nack","main","object","keys","string","required","isoDate","dotenv","config","SENTRY_DSN","install","AppError","Error","captureStackTrace","constructor","name","UnknownCorrelationIdError","correlationId","Match","match","opts","matches","find","save","League","leagues","state","leaguenameToCheck","length","setState","relatedLeagues","get","leagueIdInDb","_id","leaguenameInDb","strictlyEquals","push","similarityType","similarityCalculation","distance","isMatchByStrict","relatedLeague","sortBySimiliarity","sort","a","b","Team","team","teams","teamnameToCheck","relatedTeams","teamIdInDb","teamnameInDb","relatedTeam"],"mappings":";;;AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC7DA;;;;;;;ACAA,sC;;;;;;ACAA,gC;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AAGA;AAGA;AACA;AACA;AACA;;IAGEA,kB,GACE,2D,CADFA,kB;;IAGIC,K;;;;;;;;AACJ;;;qCAGwBC,O,EAAS;AAC/B,UAAI;AAAA,YAEAC,OAFA,GAGED,OAHF,CAEAC,OAFA;AAAA,YAMAC,UANA,GAOEF,OAPF,CAMAE,UANA;;;AASFD,kBAAUE,KAAKC,KAAL,CAAWH,QAAQI,QAAR,EAAX,CAAV;AACA,eAAO;AACLJ,0BADK;AAELC;AAFK,SAAP;AAID,OAdD,CAcE,OAAOI,KAAP,EAAc;AACd,cAAMA,KAAN;AACD;AACF;;AAED;;;;;;mCAGsBC,I,EAAMC,M,EAAQ;AAClC,UAAI;AAAA,4BAGE,2CAAAC,CAAIC,QAAJ,CAAaH,IAAb,EAAmBC,MAAnB,CAHF;AAAA,YAEAF,KAFA,iBAEAA,KAFA;;AAKF,YAAIA,KAAJ,EAAW;AACT,gBAAM,IAAIR,kBAAJ,CAAuBU,MAAvB,EAA+BD,IAA/B,EAAqCD,KAArC,CAAN;AACD;AACF,OARD,CAQE,OAAOA,KAAP,EAAc;AACd,cAAMA,KAAN;AACD;AACF;;AAED;;;;;;0CAG6BK,I,EAAMC,E,EAAI;AACrCC,cAAQC,GAAR,CAAY,8BAAZ;AACAD,cAAQC,GAAR,mBAA4BH,IAA5B;AACAE,cAAQC,GAAR,iBAA0BF,EAA1B;AACA;AACA,UAAMG,YAAY,kFAAAC,CAAWL,IAAX,EAAiBC,EAAjB,CAAlB,CALqC,CAKG;AACxC;AACA,UAAMK,mBAAmB,8EAAAC,CAAYP,IAAZ,EAAkBC,EAAlB,CAAzB,CAPqC,CAOW;AAChD,UAAMO,mBAAmB,6EAAAC,CAAYT,IAAZ,EAAkBC,EAAlB,CAAzB,CARqC,CAQW;AAChD;AACAC,cAAQC,GAAR,YAAqBC,SAArB;AACA;AACA;AACA;AACA,aAAO;AACLM,cAAMN,SADD;AAEL;AACAG,qBAAaD,gBAHR;AAILG,qBAAaD;AAJR,OAAP;AAMD;;AAED;;;;;;mCAGsBG,I,EAAMC,M,EAAmB;AAAA,UAAXhB,IAAW,uEAAJ,EAAI;;AAC7C,aAAO;AACLe,kBADK;AAELC,sBAFK;AAGLhB;AAHK,OAAP;AAKD;;;;;;AAGH,yDAAeR,KAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7DA;;;;kKAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACQyB,cADR,GACa,IAAI,mDAAJ,CAAaC,QAAQC,GAAR,CAAYC,WAAzB,CADb;AAEE;;AAFF;AAAA,mBAGQH,GAAGI,OAAH,EAHR;;AAAA;;AAKE;AACAJ,eAAGK,GAAH,CAAO,4DAAAC,EAAP;AACA;AACAN,eAAGO,QAAH,CAAY,0DAAAC,CAAaC,KAAzB;AACAT,eAAGO,QAAH,CAAY,0DAAAG,CAAYD,KAAxB;AACAT,eAAGO,QAAH,CAAY,2DAAAI,CAAcF,KAA1B;;AAVF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeG,gB;;;;;;mKAaf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAC2B,+CAAAC,CAAQT,OAAR,CAAgBH,QAAQC,GAAR,CAAYY,YAA5B,CAD3B;;AAAA;AACQC,sBADR;AAAA;AAAA,mBAEwBA,WAAWC,aAAX,EAFxB;;AAAA;AAEQC,mBAFR;AAAA;AAAA,mBAMQA,QAAQC,WAAR,CAAoBC,WAAWC,YAA/B,CANR;;AAAA;AAAA;AAAA,mBAOQH,QAAQC,WAAR,CAAoBC,WAAWE,YAA/B,CAPR;;AAAA;AAAA;AAAA,mBAUQJ,QAAQK,QAAR,CAAiB,CAAjB,CAVR;;AAAA;AAAA,8CAWSL,OAXT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAeM,sB;;;;;AAcf;;;;;;mKAGA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAIQX,kBAJR;;AAAA;AAAA;AAAA,mBAKwBW,wBALxB;;AAAA;AAKQN,mBALR;;;AAOE;;;AAGAA,oBAAQO,OAAR,CAAgBL,WAAWC,YAA3B;AAAA,+KAAyC,kBAAO5C,OAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gDAIjC,0DAAAD,CAAMkD,gBAAN,CAAuBjD,OAAvB,CAJiC,EAG1BkD,SAH0B,yBAGnCjD,OAHmC;;;AAMrCY,gCAAQC,GAAR,CAAYoC,SAAZ;;AAEA,4BAAIzB,QAAQC,GAAR,CAAYyB,aAAZ,KAA8B,MAAlC,EAA0C;AACxCpD,0BAAA,0DAAAA,CAAMqD,cAAN,CAAqBF,SAArB,EAAgC1C,MAAhC;AACD;;AAGC6C,gCAbmC,GAkBjCH,SAlBiC,CAanCG,QAbmC,EAcnCC,QAdmC,GAkBjCJ,SAlBiC,CAcnCI,QAdmC,EAenCC,MAfmC,GAkBjCL,SAlBiC,CAenCK,MAfmC,EAgBnCC,IAhBmC,GAkBjCN,SAlBiC,CAgBnCM,IAhBmC,EAiBnCC,IAjBmC,GAkBjCP,SAlBiC,CAiBnCO,IAjBmC;AAoB/BC,+BApB+B,GAoBrB,EApBqB;AAqB/BC,8BArB+B,GAqBtB,EArBsB;;AAuBrC;;;;AAGMC,qCA1B+B,GA0Bf,IAAI,2DAAJ,CAAkBL,MAAlB,EAA0B;AAC9C7C,oCAAU,IADoC;AAE9CmD,qCAAW;AAFmC,yBAA1B,CA1Be;AAAA;AAAA,+BA8B/BD,cAAcE,IAAd,EA9B+B;;AAAA;AAAA;AAAA,+BAmC3BF,cAAcG,eAAd,EAnC2B;;AAAA;AAAA;AAiC3BC,oCAjC2B,SAiCnCC,MAjCmC;AAkC/BC,gCAlC+B,SAkCnCC,EAlCmC;;;AAqCrC;;;;AAIMC,uCAzC+B,GAyCb,IAAI,0DAAJ,CAAgBf,QAAhB,EAA0B;AAChD3C,oCAAU,IADsC;AAEhDmD,qCAAW;AAFqC,yBAA1B,CAzCa;AAAA;AAAA,+BA6C/BO,gBAAgBN,IAAhB,EA7C+B;;AAAA;AAAA;AAAA,+BAkD3BM,gBAAgBL,eAAhB,EAlD2B;;AAAA;AAAA;AAgD3BM,sCAhD2B,SAgDnCJ,MAhDmC;AAiD/BK,kCAjD+B,SAiDnCH,EAjDmC;AAoD/BI,uCApD+B,GAoDb,IAAI,0DAAJ,CAAgBjB,QAAhB,EAA0B;AAChD5C,oCAAU,IADsC;AAEhDmD,qCAAW;AAFqC,yBAA1B,CApDa;AAAA;AAAA,+BAwD/BU,gBAAgBT,IAAhB,EAxD+B;;AAAA;AAAA;AAAA,+BA6D3BM,gBAAgBL,eAAhB,EA7D2B;;AAAA;AAAA;AA2D3BS,sCA3D2B,SA2DnCP,MA3DmC;AA4D/BQ,kCA5D+B,SA4DnCN,EA5DmC;;;AA+DrCtD,gCAAQC,GAAR,oBAA6BkD,YAA7B;AACAnD,gCAAQC,GAAR,sBAA+BuD,cAA/B;AACAxD,gCAAQC,GAAR,sBAA+B0D,cAA/B;;AAGA;AApEqC;AAAA;;AAAA;AAAA;AAAA;;AAsErCE,wBAAA,6CAAAA,CAAMC,gBAAN;AAtEqC,0DAuE9BlC,QAAQmC,IAAR,CAAa5E,OAAb,CAvE8B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAzC;;AAAA;AAAA;AAAA;AAAA;;AAVF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAe6E,I;;;;;;;AAlEf;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAMrE,SAAS,2CAAAC,CAAIqE,MAAJ,GAAaC,IAAb,CAAkB;AAC/B1B,YAAU,2CAAA5C,CAAIuE,MAAJ,GAAaC,QAAb,EADqB;AAE/B3B,YAAU,2CAAA7C,CAAIuE,MAAJ,GAAaC,QAAb,EAFqB;AAG/B1B,UAAQ,2CAAA9C,CAAIuE,MAAJ,GAAaC,QAAb,EAHuB;AAI/BzB,QAAM,2CAAA/C,CAAIuE,MAAJ,GAAaC,QAAb,EAJyB;AAK/BxB,QAAM,2CAAAhD,CAAIuE,MAAJ,GAAaE,OAAb,GAAuBD,QAAvB;AALyB,CAAlB,CAAf;;AAQA,8CAAAE,CAAOC,MAAP;;AAEA,6CAAAV,CAAMU,MAAN,CAAa3D,QAAQC,GAAR,CAAY2D,UAAzB,EAAqCC,OAArC;;AAEA;;;AAGA,IAAM3C,aAAa;AACjBC,gBAAc,SADG;AAEjBC,gBAAc;AAFG,CAAnB;;AA4HAgC,O;;;;;;ACxJA,gD;;;;;;ACAA,mC;;;;;;ACAA,oC;;;;;;ACAA,iD;;;;;;ACAA,kC;;;;;;ACAA,2D;;;;;;ACAA,4D;;;;;;ACAA,mE;;;;;;ACAA,0D;;;;;;ACAA,kE;;;;;;;;;;;;;ICAMU,Q;;;AACJ,oBAAYvF,OAAZ,EAAqB;AAAA;;AAInB;AAJmB,oHAEbA,OAFa;AACnB;;;AAIAwF,UAAMC,iBAAN,QAA8B,MAAKC,WAAnC;;AAEA;AACA,UAAKC,IAAL,GAAY,MAAKD,WAAL,CAAiBC,IAA7B;AARmB;AASpB;;;EAVoBH,K;;IAajB1F,kB;;;AACJ,8BAAYU,MAAZ,EAAoBD,IAApB,EAA0BD,KAA1B,EAAiC;AAAA;;AAAA,yIACtBE,MADsB,8CACyBF,KADzB;;AAG/B,WAAKE,MAAL,GAAcA,MAAd;AACA,WAAKD,IAAL,GAAYA,IAAZ;AACA,WAAKD,KAAL,GAAaA,KAAb;AAL+B;AAMhC;;;EAP8BkF,K;;IAU3BI,yB;;;AACJ,uCAA+C;AAAA,QAAnCC,aAAmC,uEAAnB,IAAmB;AAAA,QAAbvE,IAAa,uEAAN,IAAM;;AAAA;;AAAA,uJACvC,6BADuC;;AAG7C,WAAKuE,aAAL,GAAqBA,aAArB;AACA,WAAKvE,IAAL,GAAYA,IAAZ;AAJ6C;AAK9C;;;EANqCiE,Q;;AASxC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,yDAAe;AACbK,sDADa;AAEb9F;AAFa,CAAf,E;;;;;;;;;;;;;;;;;;;;;;;ACxDA;;IAIMgG,K;;;;;;;;;;;iCACgB;AAClB,aAAO,SAAP;AACD;;;;EAHiB,gD;;IAMd9D,Y;AACJ,wBAAY+D,KAAZ,EAA8B;AAAA,QAAXC,IAAW,uEAAJ,EAAI;;AAAA;;AAC5B,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKD,KAAL,GAAaA,KAAb;AACA,SAAKE,OAAL,GAAe,IAAf;AACD;;;;;;;;;;;uBAOsBH,MAAMI,IAAN,E;;;AAArB,qBAAKD,O;;;;;;;;;;;;;;;;;;;;;;;;;AAICF,qB,GAAQ,KAAKA,K;;uBAEb,IAAID,KAAJ,CAAUC,KAAV,EAAiBI,IAAjB,E;;;;;;;;;;;;;;;;;;wBAXW;AACjB,aAAOL,KAAP;AACD;;;;;;AAaH,yDAAe9D,YAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;AAIA;AACA;;AAEA,IAAMxB,SAAS,2CAAAC,CAAIuE,MAAJ,GAAaC,QAAb,EAAf;;IAEMmB,M;;;;;;;;;;;iCACgB;AAClB,aAAO,SAAP;AACD;;;;EAHkB,gD;;IAMfjE,a;AACJ,yBAAYoB,MAAZ,EAA+B;AAAA,QAAXyC,IAAW,uEAAJ,EAAI;;AAAA;;AAC7B,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAKzC,MAAL,GAAcA,MAAd;AACA,SAAK8C,OAAL,GAAe,IAAf;;AAH6B,yBAOzBL,IAPyB,CAM3BtF,QAN2B;AAAA,QAM3BA,QAN2B,kCAMhB,IANgB;;AAS7B;;AACA,QAAIA,QAAJ,EAAc;AACZX,MAAA,0DAAAA,CAAMqD,cAAN,CAAqBG,MAArB,EAA6B/C,MAA7B;AACD;AACF;;;;;;;;;;;uBAWsB4F,OAAOF,IAAP,E;;;AAArB,qBAAKG,O;;;;;;;;;;;;;;;;;;;;;;;;;AAICV,oB,GAAO,KAAKpC,M;;uBAEZ,IAAI6C,MAAJ,CAAW;AACfT;AADe,iBAAX,EAEHQ,IAFG,E;;;;;;;;;;;;;;;;;;+BAK4B;AAAA,UAA3BlC,MAA2B,uEAAlB,IAAkB;AAAA,UAAZE,EAAY,uEAAP,KAAO;;AAClC,WAAKmC,KAAL,GAAa;AACXrC,sBADW;AAEXE;AAFW,OAAb;AAID;;;;;;;;;;;AAGOkC,uB,GAAU,KAAKA,O;AACfE,iC,GAAoB,KAAKhD,M;kCAG3B,KAAKyC,I,CADPnC,S,EAAAA,S,mCAAY,I;;sBAGVwC,QAAQG,MAAR,KAAmB,C;;;;;AACrB,qBAAKC,QAAL;kDACO,KAAKH,K;;;AAGRI,8B,GAAiB,E;;AAEvB;;;;;;4BACqBL,O;;;;;;;;AAAV9C,sB;;uBAICA,OAAOoD,GAAP,E;;;;AAFHC,4B,SAALC,G;AACMC,8B,SAANnB,I;AACsB;;AAElBoB,8B,GAAiBD,mBAAmBP,iB;;AAE1C;;AACA,oBAAIQ,cAAJ,EAAoB;AAClBL,iCAAeM,IAAf,CAAoB,0DAAAjH,CAAMkH,cAAN,CAAqB,QAArB,EAA+BH,cAA/B,EAA+C;AACjE3C,wBAAI,IAAI,mDAAJ,CAAayC,YAAb;AAD6D,mBAA/C,CAApB;AAGD;;AAED,oBAAI/C,aAAa,CAACkD,cAAlB,EAAkC;AAAA,0CAI5B,0DAAAhH,CAAMmH,qBAAN,CAA4BJ,cAA5B,EAA4CP,iBAA5C,CAJ4B,EAExBxF,SAFwB,yBAE9BM,IAF8B,EAGjBF,gBAHiB,yBAG9BC,WAH8B;;;AAMhC,sBAAIL,aAAa,GAAb,IAAoBI,oBAAoB,CAA5C,EAA+C;AAC7C;AACAuF,mCAAeM,IAAf,CAAoB,0DAAAjH,CAAMkH,cAAN,CAAqB,MAArB,EAA6BH,cAA7B,EAA6C;AAC/D9F,kCAAYD,SADmD;AAE/DoG,gCAAUhG,gBAFqD;AAG/DgD,0BAAI,IAAI,mDAAJ,CAAayC,YAAb;AAH2D,qBAA7C,CAApB;AAKD;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sBAGCF,eAAeF,MAAf,KAA0B,C;;;;;AAC5B,qBAAKC,QAAL;kDACO,KAAKH,K;;;AAGRc,+B,GAAkBV,eAAeR,IAAf,CAAoB;AAAA,yBAAiBmB,cAAc/F,IAAd,KAAuB,QAAxC;AAAA,iBAApB,C;;qBAEpB8F,e;;;;;AAGEjD,mB,GAEAiD,e,CAHF7G,I,CACE4D,E;;;AAIJ,qBAAKsC,QAAL,CAAc,KAAd,EAAqBtC,GAArB;kDACO,KAAKmC,K;;;AAGRgB,iC,GAAoBZ,eAAea,IAAf,CAAoB,UAACC,CAAD,EAAIC,CAAJ;AAAA,yBAC3CD,EAAEjH,IAAF,CAAOS,UAAP,GAAoByG,EAAElH,IAAF,CAAOS,UADgB;AAAA,iBAApB,C;AAIxBmD,kB,GACEmD,kBAAkBA,kBAAkBd,MAAlB,GAA2B,CAA7C,C,CADFrC,E;;;AAGF,qBAAKsC,QAAL,CAAc,KAAd,EAAqBtC,EAArB;kDACO,KAAKmC,K;;;;;;;;;;;;;;;;;;wBApGK;AACjB,aAAOF,MAAP;AACD;;;wBAEmB;AAClB,aAAO5F,MAAP;AACD;;;;;;AAkGH,yDAAe2B,aAAf,E;;;;;;;;;;;;;;;;;;;;;;;;;;ACvIA;AAIA;AACA;;AAEA,IAAM3B,SAAS,2CAAAC,CAAIuE,MAAJ,GAAaC,QAAb,EAAf;;IAEMyC,I;;;;;;;;;;;iCACgB;AAClB,aAAO,OAAP;AACD;;;;EAHgB,gD;;IAMbxF,W;AACJ,uBAAYyF,IAAZ,EAA6B;AAAA,QAAX3B,IAAW,uEAAJ,EAAI;;AAAA;;AAC3B,SAAKA,IAAL,GAAYA,IAAZ;AACA,SAAK2B,IAAL,GAAYA,IAAZ;AACA,SAAKC,KAAL,GAAa,IAAb;;AAH2B,yBAOvB5B,IAPuB,CAMzBtF,QANyB;AAAA,QAMzBA,QANyB,kCAMd,IANc;;AAS3B;;AACA,QAAIA,QAAJ,EAAc;AACZX,MAAA,0DAAAA,CAAMqD,cAAN,CAAqBuE,IAArB,EAA2BnH,MAA3B;AACD;AACF;;;;;;;;;;;uBAWoBkH,KAAKxB,IAAL,E;;;AAAnB,qBAAK0B,K;;;;;;;;;;;;;;;;;;;;;;;;;AAICjC,oB,GAAO,KAAKgC,I;;uBAEZ,IAAID,IAAJ,CAAS;AACb/B;AADa,iBAAT,EAEHQ,IAFG,E;;;;;;;;;;;;;;;;;;+BAK4B;AAAA,UAA3BlC,MAA2B,uEAAlB,IAAkB;AAAA,UAAZE,EAAY,uEAAP,KAAO;;AAClC,WAAKmC,KAAL,GAAa;AACXrC,sBADW;AAEXE;AAFW,OAAb;AAID;;;;;;;;;;;AAGOyD,qB,GAAQ,KAAKA,K;AACbC,+B,GAAkB,KAAKF,I;kCAGzB,KAAK3B,I,CADPnC,S,EAAAA,S,mCAAY,I;;sBAGV+D,MAAMpB,MAAN,KAAiB,C;;;;;AACnB,qBAAKC,QAAL;kDACO,KAAKH,K;;;AAGRwB,4B,GAAe,E;;AAErB;;;;;;4BACmBF,K;;;;;;;;AAARD,oB;;uBAICA,KAAKhB,GAAL,E;;;;AAFHoB,0B,SAALlB,G;AACMmB,4B,SAANrC,I;AACoB;;AAEhBoB,8B,GAAiBiB,iBAAiBH,e;;AAExC;;AACA,oBAAId,cAAJ,EAAoB;AAClBe,+BAAad,IAAb,CAAkB,0DAAAjH,CAAMkH,cAAN,CAAqB,QAArB,EAA+Be,YAA/B,EAA6C;AAC7D7D,wBAAI,IAAI,mDAAJ,CAAa4D,UAAb;AADyD,mBAA7C,CAAlB;AAGD;;AAED,oBAAIlE,aAAa,CAACkD,cAAlB,EAAkC;AAAA,0CAI5B,0DAAAhH,CAAMmH,qBAAN,CAA4Bc,YAA5B,EAA0CH,eAA1C,CAJ4B,EAExB9G,SAFwB,yBAE9BM,IAF8B,EAGjBF,gBAHiB,yBAG9BC,WAH8B;;;AAMhC,sBAAIL,aAAa,GAAjB,EAAsB;AACpB;AACA+G,iCAAad,IAAb,CAAkB,0DAAAjH,CAAMkH,cAAN,CAAqB,MAArB,EAA6Be,YAA7B,EAA2C;AAC3DhH,kCAAYD,SAD+C;AAE3DoG,gCAAUhG,gBAFiD;AAG3DgD,0BAAI,IAAI,mDAAJ,CAAa4D,UAAb;AAHuD,qBAA3C,CAAlB;AAKD;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sBAGCD,aAAatB,MAAb,KAAwB,C;;;;;AAC1B,qBAAKC,QAAL;kDACO,KAAKH,K;;;AAGRc,+B,GAAkBU,aAAa5B,IAAb,CAAkB;AAAA,yBAAe+B,YAAY3G,IAAZ,KAAqB,QAApC;AAAA,iBAAlB,C;;qBAEpB8F,e;;;;;AAGEjD,mB,GAEAiD,e,CAHF7G,I,CACE4D,E;;;AAIJ,qBAAKsC,QAAL,CAAc,KAAd,EAAqBtC,GAArB;kDACO,KAAKmC,K;;;AAGRgB,iC,GAAoBQ,aAAaP,IAAb,CAAkB,UAACC,CAAD,EAAIC,CAAJ;AAAA,yBAAWD,EAAEjH,IAAF,CAAOS,UAAP,GAAoByG,EAAElH,IAAF,CAAOS,UAAtC;AAAA,iBAAlB,C;;AAE1B;;AAGImD,kB,GAEAmD,kBAAkBA,kBAAkBd,MAAlB,GAA2B,CAA7C,C,CAHFjG,I,CACE4D,E;;;AAIJ,qBAAKsC,QAAL,CAAc,KAAd,EAAqBtC,EAArB;kDACO,KAAKmC,K;;;;;;;;;;;;;;;;;;wBAtGK;AACjB,aAAOoB,IAAP;AACD;;;wBAEmB;AAClB,aAAOlH,MAAP;AACD;;;;;;AAoGH,yDAAe0B,WAAf,E","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7f581201574d13b4a898","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","module.exports = require(\"mongorito\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongorito\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"joi\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"joi\"\n// module id = 2\n// module chunks = 0","import Joi from 'joi';\nimport {\n  similarity,\n} from 'talisman/metrics/distance/dice';\nimport {\n  isSimilar,\n} from 'talisman/metrics/distance/eudex';\nimport jaroWinkler from 'talisman/metrics/distance/jaro-winkler';\nimport mra from 'talisman/metrics/distance/mra';\nimport levenshtein from 'talisman/metrics/distance/levenshtein';\nimport Errors from './errors.js';\n\nconst {\n  InvalidSchemaError,\n} = Errors;\n\nclass Utils {\n  /*\n    Convert a buffer typed rabbitmq message to JSON object\n  */\n  static getContentAsJSON(message) {\n    try {\n      let {\n        content,\n      } = message;\n\n      const {\n        properties,\n      } = message;\n\n      content = JSON.parse(content.toString());\n      return {\n        content,\n        properties,\n      };\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /*\n    Validate json schema\n  */\n  static validateSchema(data, schema) {\n    try {\n      const {\n        error,\n      } = Joi.validate(data, schema);\n\n      if (error) {\n        throw new InvalidSchemaError(schema, data, error);\n      }\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  /*\n    Check similarity between two string\n  */\n  static similarityCalculation(from, to) {\n    console.log('-= Calculating similarity =-');\n    console.log(`entity_from: ${from}`);\n    console.log(`entity_to: ${to}`);\n    // const eudexValue = isSimilar(from, to); // similar\n    const diceValue = similarity(from, to); // similar\n    // const mraValue = mra(from, to); // similar\n    const jaroWinklerValue = jaroWinkler(from, to); // distance\n    const levenshteinValue = levenshtein(from, to); // metric distance\n    // console.log(`eudex: ${eudexValue}`);\n    console.log(`dice: ${diceValue}`);\n    // console.log(`mra: match: ${mraValue.matching}, value: ${mraValue.similarity}`);\n    // console.log(`jarowWinkler: ${jaroWinklerValue}`);\n    // console.log(`levenshtein: ${levenshteinValue}`);\n    return {\n      dice: diceValue,\n      //mra: mraValue,\n      jaroWinkler: jaroWinklerValue,\n      levenshtein: levenshteinValue,\n    };\n  }\n\n  /*\n    Construct a similarity info object\n  */\n  static similarityType(type, entity, data = {}) {\n    return {\n      type,\n      entity,\n      data,\n    };\n  }\n}\n\nexport default Utils;\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","import dotenv from 'dotenv';\nimport amqplib from 'amqplib';\nimport {\n  Database,\n} from 'mongorito';\nimport timestamps from 'mongorito-timestamps';\nimport Raven from 'raven';\nimport Joi from 'joi';\nimport Utils from './utils.js';\nimport MatchService from './match.js';\nimport LeagueService from './league.js';\nimport TeamService from './team.js';\n\nconst schema = Joi.object().keys({\n  homeTeam: Joi.string().required(),\n  awayTeam: Joi.string().required(),\n  league: Joi.string().required(),\n  game: Joi.string().required(),\n  date: Joi.string().isoDate().required(),\n});\n\ndotenv.config();\n\nRaven.config(process.env.SENTRY_DSN).install();\n\n/*\n  Queue declarations\n */\nconst QueueTypes = {\n  CREATE_MATCH: 'matches',\n  FAILED_MATCH: 'failed_matches',\n};\n\n/*\n  Db\n */\nasync function initDbConnection() {\n  const db = new Database(process.env.MONGODB_URI);\n  // connect\n  await db.connect();\n\n  // plugin\n  db.use(timestamps());\n  // registering model\n  db.register(MatchService.model);\n  db.register(TeamService.model);\n  db.register(LeagueService.model);\n}\n\nasync function initRabbitMQConnection() {\n  const connection = await amqplib.connect(process.env.RABBITMQ_URI);\n  const channel = await connection.createChannel();\n  /*\n    Creating queues that service depends on\n   */\n  await channel.assertQueue(QueueTypes.CREATE_MATCH);\n  await channel.assertQueue(QueueTypes.FAILED_MATCH);\n\n  // one by one\n  await channel.prefetch(1);\n  return channel;\n}\n\n/*\n  Entry\n */\nasync function main() {\n  /*\n    Bootstrap core dependencies\n   */\n  await initDbConnection();\n  const channel = await initRabbitMQConnection();\n\n  /*\n    Consumers\n  */\n  channel.consume(QueueTypes.CREATE_MATCH, async (message) => {\n    try {\n      const {\n        content: matchData,\n      } = Utils.getContentAsJSON(message);\n\n      console.log(matchData);\n\n      if (process.env.VALIDATE_BASE === 'true') {\n        Utils.validateSchema(matchData, schema);\n      }\n\n      const {\n        homeTeam,\n        awayTeam,\n        league,\n        game,\n        date,\n      } = matchData;\n\n      const matchId = '';\n      const gameId = '';\n\n      /*\n        League\n      */\n      const leagueService = new LeagueService(league, {\n        validate: true,\n        algoCheck: true,\n      });\n      await leagueService.init();\n\n      const {\n        unique: leagueUnique,\n        id: leagueId,\n      } = await leagueService.similarityCheck();\n\n      /*\n        Team\n      */\n\n      const homeTeamService = new TeamService(homeTeam, {\n        validate: true,\n        algoCheck: true,\n      });\n      await homeTeamService.init();\n\n      const {\n        unique: homeTeamUnique,\n        id: homeTeamId,\n      } = await homeTeamService.similarityCheck();\n\n      const awayTeamService = new TeamService(awayTeam, {\n        validate: true,\n        algoCheck: true,\n      });\n      await awayTeamService.init();\n\n      const {\n        unique: awayTeamUnique,\n        id: awayTeamId,\n      } = await homeTeamService.similarityCheck();\n\n      console.log(`leagueunique: ${leagueUnique}`)\n      console.log(`hometeamunique: ${homeTeamUnique}`)\n      console.log(`awayteamunique: ${awayTeamUnique}`)\n\n\n      //return channel.ack(message);\n    } catch (error) {\n      Raven.captureException(error);\n      return channel.nack(message);\n    }\n  });\n}\n\nmain();\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"amqplib\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"amqplib\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"mongorito-timestamps\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongorito-timestamps\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"raven\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"raven\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"talisman/metrics/distance/dice\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"talisman/metrics/distance/dice\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"talisman/metrics/distance/eudex\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"talisman/metrics/distance/eudex\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"talisman/metrics/distance/jaro-winkler\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"talisman/metrics/distance/jaro-winkler\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"talisman/metrics/distance/mra\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"talisman/metrics/distance/mra\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"talisman/metrics/distance/levenshtein\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"talisman/metrics/distance/levenshtein\"\n// module id = 15\n// module chunks = 0","class AppError extends Error {\n  constructor(message) {\n    // error constructor call.\n    super(message);\n\n    // stacktrace saving\n    Error.captureStackTrace(this, this.constructor);\n\n    // just in case we save name of class too\n    this.name = this.constructor.name;\n  }\n}\n\nclass InvalidSchemaError extends Error {\n  constructor(schema, data, error) {\n    super(`${schema} schema validation failed with error: ${error}`);\n\n    this.schema = schema;\n    this.data = data;\n    this.error = error;\n  }\n}\n\nclass UnknownCorrelationIdError extends AppError {\n  constructor(correlationId = null, type = null) {\n    super('Correlation Id\\'s not found');\n\n    this.correlationId = correlationId;\n    this.type = type;\n  }\n}\n\n// class ThresholdInvalidError extends AppError {\n//   constructor(threshold = null) {\n//     super('Threshold\\'s invalid');\n\n//     this.threshold = threshold;\n//   }\n// }\n\n// class KeywordInvalidError extends AppError {\n//   constructor(keyword = null) {\n//     super('Keyword\\'s invalid');\n\n//     this.keyword = keyword;\n//   }\n// }\n\n// class KeywordDuplicationError extends AppError {\n//   constructor(keyword = null) {\n//     super('Keyword\\'s already submitted');\n\n//     this.keyword = keyword;\n//   }\n// }\n\nexport default {\n  UnknownCorrelationIdError,\n  InvalidSchemaError,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/errors.js","import {\n  Model,\n} from 'mongorito';\n\nclass Match extends Model {\n  static collection() {\n    return 'matches';\n  }\n}\n\nclass MatchService {\n  constructor(match, opts = {}) {\n    this.opts = opts;\n    this.match = match;\n    this.matches = null;\n  }\n\n  static get model() {\n    return Match;\n  }\n\n  async init() {\n    this.matches = await Match.find();\n  }\n\n  async save() {\n    const match = this.match;\n\n    await new Match(match).save();\n  }\n}\n\nexport default MatchService;\n\n\n\n// WEBPACK FOOTER //\n// ./src/match.js","import {\n  Model,\n  ObjectId,\n} from 'mongorito';\nimport Joi from 'joi';\nimport Utils from './utils.js';\n\nconst schema = Joi.string().required();\n\nclass League extends Model {\n  static collection() {\n    return 'leagues';\n  }\n}\n\nclass LeagueService {\n  constructor(league, opts = {}) {\n    this.opts = opts;\n    this.league = league;\n    this.leagues = null;\n\n    const {\n      validate = true,\n    } = opts;\n\n    // check if we need to validate passed league data\n    if (validate) {\n      Utils.validateSchema(league, schema);\n    }\n  }\n\n  static get model() {\n    return League;\n  }\n\n  static get schema() {\n    return schema;\n  }\n\n  async init() {\n    this.leagues = await League.find();\n  }\n\n  async save() {\n    const name = this.league;\n\n    await new League({\n      name,\n    }).save();\n  }\n\n  setState(unique = true, id = false) {\n    this.state = {\n      unique,\n      id,\n    };\n  }\n\n  async similarityCheck() {\n    const leagues = this.leagues;\n    const leaguenameToCheck = this.league;\n    const {\n      algoCheck = true,\n    } = this.opts;\n\n    if (leagues.length === 0) {\n      this.setState();\n      return this.state;\n    }\n\n    const relatedLeagues = [];\n\n    // we check similarity with every entity in db\n    for (const league of leagues) { // eslint-disable-line\n      const {\n        _id: leagueIdInDb,\n        name: leaguenameInDb,\n      } = await league.get(); // eslint-disable-line\n\n      const strictlyEquals = leaguenameInDb === leaguenameToCheck;\n\n      // strictly equal\n      if (strictlyEquals) {\n        relatedLeagues.push(Utils.similarityType('strict', leaguenameInDb, {\n          id: new ObjectId(leagueIdInDb),\n        }));\n      }\n\n      if (algoCheck && !strictlyEquals) {\n        const {\n          dice: diceValue, // int\n          levenshtein: levenshteinValue,\n        } = Utils.similarityCalculation(leaguenameInDb, leaguenameToCheck);\n\n        if (diceValue >= 0.7 && levenshteinValue <= 2) {\n          // similar but char differences are between ]0,2] equal by length\n          relatedLeagues.push(Utils.similarityType('algo', leaguenameInDb, {\n            similarity: diceValue,\n            distance: levenshteinValue,\n            id: new ObjectId(leagueIdInDb),\n          }));\n        }\n      }\n    }\n\n    if (relatedLeagues.length === 0) {\n      this.setState();\n      return this.state;\n    }\n\n    const isMatchByStrict = relatedLeagues.find(relatedLeague => relatedLeague.type === 'strict');\n\n    if (isMatchByStrict) {\n      const {\n        data: {\n          id,\n        },\n      } = isMatchByStrict;\n\n      this.setState(false, id);\n      return this.state;\n    }\n\n    const sortBySimiliarity = relatedLeagues.sort((a, b) =>\n      (a.data.similarity - b.data.similarity));\n\n    const {\n      id,\n    } = sortBySimiliarity[sortBySimiliarity.length - 1];\n\n    this.setState(false, id);\n    return this.state;\n  }\n}\n\nexport default LeagueService;\n\n\n\n// WEBPACK FOOTER //\n// ./src/league.js","import {\n  Model,\n  ObjectId,\n} from 'mongorito';\nimport Joi from 'joi';\nimport Utils from './utils.js';\n\nconst schema = Joi.string().required();\n\nclass Team extends Model {\n  static collection() {\n    return 'teams';\n  }\n}\n\nclass TeamService {\n  constructor(team, opts = {}) {\n    this.opts = opts;\n    this.team = team;\n    this.teams = null;\n\n    const {\n      validate = true,\n    } = opts;\n\n    // check if we need to validate passed league data\n    if (validate) {\n      Utils.validateSchema(team, schema);\n    }\n  }\n\n  static get model() {\n    return Team;\n  }\n\n  static get schema() {\n    return schema;\n  }\n\n  async init() {\n    this.teams = await Team.find();\n  }\n\n  async save() {\n    const name = this.team;\n\n    await new Team({\n      name,\n    }).save();\n  }\n\n  setState(unique = true, id = false) {\n    this.state = {\n      unique,\n      id,\n    };\n  }\n\n  async similarityCheck() {\n    const teams = this.teams;\n    const teamnameToCheck = this.team;\n    const {\n      algoCheck = true,\n    } = this.opts;\n\n    if (teams.length === 0) {\n      this.setState();\n      return this.state;\n    }\n\n    const relatedTeams = [];\n\n    // we check similarity with every entity in db\n    for (const team of teams) { // eslint-disable-line\n      const {\n        _id: teamIdInDb,\n        name: teamnameInDb,\n      } = await team.get(); // eslint-disable-line\n\n      const strictlyEquals = teamnameInDb === teamnameToCheck;\n\n      // strictly equal\n      if (strictlyEquals) {\n        relatedTeams.push(Utils.similarityType('strict', teamnameInDb, {\n          id: new ObjectId(teamIdInDb),\n        }));\n      }\n\n      if (algoCheck && !strictlyEquals) {\n        const {\n          dice: diceValue, // int\n          levenshtein: levenshteinValue,\n        } = Utils.similarityCalculation(teamnameInDb, teamnameToCheck);\n\n        if (diceValue >= 0.3) {\n          // similar but char differences are between ]0,2] equal by length\n          relatedTeams.push(Utils.similarityType('algo', teamnameInDb, {\n            similarity: diceValue,\n            distance: levenshteinValue,\n            id: new ObjectId(teamIdInDb),\n          }));\n        }\n      }\n    }\n\n    if (relatedTeams.length === 0) {\n      this.setState();\n      return this.state;\n    }\n\n    const isMatchByStrict = relatedTeams.find(relatedTeam => relatedTeam.type === 'strict');\n\n    if (isMatchByStrict) {\n      const {\n        data: {\n          id,\n        },\n      } = isMatchByStrict;\n\n      this.setState(false, id);\n      return this.state;\n    }\n\n    const sortBySimiliarity = relatedTeams.sort((a, b) => (a.data.similarity - b.data.similarity));\n\n    // get higher similar team\n    const {\n      data: {\n        id,\n      },\n    } = sortBySimiliarity[sortBySimiliarity.length - 1];\n\n    this.setState(false, id);\n    return this.state;\n  }\n}\n\nexport default TeamService;\n\n\n\n// WEBPACK FOOTER //\n// ./src/team.js"],"sourceRoot":""}